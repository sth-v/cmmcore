//
// Created by Andrew Astakhov on 28.09.24.
//
#include "cmmcore/nurbs.h"
#include "cmmcore/ccx.h"
#include "cmmcore/serialization.h"
#include <chrono>
using namespace cmmcore;


int main(){
    auto crv2 = cmmcore::NURBSCurve({{3.4010600706713725, -8.3244994110718498, 0.0}, {-8.8103651354534769, -20.535924617196706, 0.0}, {-27.930622189516178, -15.412667180485142, 0.0}, {-30.403077120132302, -1.3906784826577496, 0.0}, {-19.044632940199335, 14.830860932605066, 0.0}, {-11.915763049431774, 8.8490288365511915, 0.0}, {-11.915763049431774, -3.0771495877502932, 0.0}, {-9.5303679753416617, -7.2087750521988934, 0.0}, {2.3687040367011853, -2.8778670244252527, 0.0}, {7.1444098350799301, 7.3636671105155980, 0.0}, {-5.3668513824107160, 14.587047142335550, 0.0}, {-1.3388931087918676, 21.563675523010822, 0.0}, {22.576560659599533, 21.563675523010822, 0.0}, {26.007323209822314, 8.7598953768747680, 0.0}, {21.567184121481901, -0.76201362609627399, 0.0}},3);
    auto crv3 = cmmcore::NURBSCurve({{4.3727915194346298, -20.892226148409897, 0.0}, {-15.809185905268865, -11.481215518559384, 0.0}, {-35.251266488171950, -13.182177164920892, 0.0}, {-37.894885352899742, 1.8105304406079412, 0.0}, {-26.932162804362278, 6.9225319192194252, 0.0}, {-16.490714012944952, -5.5211021898406338, 0.0}, {-5.7000558489264286, -8.4124503306896994, 0.0}, {-3.570738782457898, 3.6635068365750110, 0.0}, {-18.010995527345969, 6.2097137090561736, 0.0}, {-24.479875410126734, 13.919024549420557, 0.0}, {-10.347966765600773, 20.508841774709857, 0.0}, {-4.5676076339856122, 8.1128216139305014, 0.0}, {7.9472042432245082, 5.9061226214876079, 0.0}, {14.368356550514143, 11.294109154267478, 0.0}, {4.0962534307586473, 23.535924950734287, 0.0}, {10.390107546103732, 24.086565835712964, 0.0}, {23.621237154766042, 22.928991989312816, 0.0}, {28.468027125719846, 14.534105506005556, 0.0}, {26.406040106065035, -9.0345139762639235, 0.0}, {14.747143888629237, -5.9105221501637235, 0.0}, {-0.31806976673567178, -11.393811493577273, 0.0}, {-6.0732707230977505, -11.897326333572510, 0.0}},3);
    //deserializeNURBSCurves("")
    auto ixss=std::vector<std::pair<double,double>>();
    auto timer=Timer(1);
    timer.start();
    ccx(crv2,crv3, 1e-3,ixss);
    timer.stop();
    timer.print();
    printf("\n[");
    std::vector<vec3> pts1(ixss.size());
    std::vector<vec3> pts2(ixss.size());
    for (int i = 0; i < ixss.size(); i++) {
        crv2.evaluate(ixss[i].first,pts1[i]);
        crv3.evaluate(ixss[i].second,pts2[i]);
        printf("[%f,%f],",ixss[i].first , ixss[i].second );
    }

    //for (int i = 0; i < ixss.size(); i++) {
    //    printf("[%f,%f,%f]",pts1[i].x,pts1[i].y,pts1[i].z);

    //}
    printf("]\n");


};