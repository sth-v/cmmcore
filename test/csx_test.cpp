//
// Created by Andrew Astakhov on 26.10.24.
//
#include "cmmcore/nurbs.h"
#include "cmmcore/csx.h"
using namespace cmmcore;
int main() {
  NURBSSurface surface={{{{65.668648599999997, 93.742056700000006, 41.411005299999999, 1.}, {65.668648599999997, 93.742056700000006, 0.104986018, 1.}}, {{65.703813100000005, 92.801841899999999, 41.411005299999999, 1.}, {65.703813100000005, 92.801841899999999, 0.104986018, 1.}}, {{65.938667800000005, 90.933447999999999, 41.411005299999999, 1.}, {65.938667800000005, 90.933447999999999, 0.104986018, 1.}}, {{66.767644700000005, 88.251394300000001, 41.411005299999999, 1.}, {66.767644700000005, 88.251394300000001, 0.104986018, 1.}}, {{68.042401299999995, 85.769843100000003, 41.411005299999999, 1.}, {68.042401299999995, 85.769843100000003, 0.104986018, 1.}}, {{69.718665099999996, 83.561609300000001, 41.411005299999999, 1.}, {69.718665099999996, 83.561609300000001, 0.104986018, 1.}}, {{71.740565399999994, 81.690308999999999, 41.411005299999999, 1.}, {71.740565399999994, 81.690308999999999, 0.104986018, 1.}}, {{74.042390600000004, 80.208508199999997, 41.411005299999999, 1.}, {74.042390600000004, 80.208508199999997, 0.104986018, 1.}}, {{76.550738999999993, 79.156263100000004, 41.411005299999999, 1.}, {76.550738999999993, 79.156263100000004, 0.104986018, 1.}}, {{79.186847599999993, 78.560051599999994, 41.411005299999999, 1.}, {79.186847599999993, 78.560051599999994, 0.104986018, 1.}}, {{81.869064800000004, 78.432136299999996, 41.411005299999999, 1.}, {81.869064800000004, 78.432136299999996, 0.104986018, 1.}}, {{84.515377500000000, 78.770370099999994, 41.411005299999999, 1.}, {84.515377500000000, 78.770370099999994, 0.104986018, 1.}}, {{87.045919600000005, 79.558443900000000, 41.411005299999999, 1.}, {87.045919600000005, 79.558443900000000, 0.104986018, 1.}}, {{89.385381400000000, 80.766566499999996, 41.411005299999999, 1.}, {89.385381400000000, 80.766566499999996, 0.104986018, 1.}}, {{91.465250699999999, 82.352546399999994, 41.411005299999999, 1.}, {91.465250699999999, 82.352546399999994, 0.104986018, 1.}}, {{93.225815600000004, 84.263241100000002, 41.411005299999999, 1.}, {93.225815600000004, 84.263241100000002, 0.104986018, 1.}}, {{94.617873500000002, 86.436322000000004, 41.411005299999999, 1.}, {94.617873500000002, 86.436322000000004, 0.104986018, 1.}}, {{95.604095400000006, 88.802298100000002, 41.411005299999999, 1.}, {95.604095400000006, 88.802298100000002, 0.104986018, 1.}}, {{96.160009500000001, 91.286732700000002, 41.411005299999999, 1.}, {96.160009500000001, 91.286732700000002, 0.104986018, 1.}}, {{96.274577399999998, 93.812582399999997, 41.411005299999999, 1.}, {96.274577399999998, 93.812582399999997, 0.104986018, 1.}}, {{95.950352100000003, 96.302585699999995, 41.411005299999999, 1.}, {95.950352100000003, 96.302585699999995, 0.104986018, 1.}}, {{95.203216600000005, 98.681625400000001, 41.411005299999999, 1.}, {95.203216600000005, 98.681625400000001, 0.104986018, 1.}}, {{94.061718700000000, 100.87899500000000, 41.411005299999999, 1.}, {94.061718700000000, 100.87899500000000, 0.104986018, 1.}}, {{92.566025100000004, 102.83050100000000, 41.411005299999999, 1.}, {92.566025100000004, 102.83050100000000, 0.104986018, 1.}}, {{90.766535300000001, 104.48033000000000, 41.411005299999999, 1.}, {90.766535300000001, 104.48033000000000, 0.104986018, 1.}}, {{88.722198800000001, 105.78264500000000, 41.411005299999999, 1.}, {88.722198800000001, 105.78264500000000, 0.104986018, 1.}}, {{86.498594999999995, 106.70284400000000, 41.411005299999999, 1.}, {86.498594999999995, 106.70284400000000, 0.104986018, 1.}}, {{84.165834500000003, 107.21846100000000, 41.411005299999999, 1.}, {84.165834500000003, 107.21846100000000, 0.104986018, 1.}}, {{81.796352099999993, 107.31968100000000, 41.411005299999999, 1.}, {81.796352099999993, 107.31968100000000, 0.104986018, 1.}}, {{79.462658500000003, 107.00946399999999, 41.411005299999999, 1.}, {79.462658500000003, 107.00946399999999, 0.104986018, 1.}}, {{77.235121100000001, 106.30326700000001, 41.411005299999999, 1.}, {77.235121100000001, 106.30326700000001, 0.104986018, 1.}}, {{75.179842800000003, 105.22839399999999, 41.411005299999999, 1.}, {75.179842800000003, 105.22839399999999, 0.104986018, 1.}}, {{73.356701200000003, 103.82298700000000, 41.411005299999999, 1.}, {73.356701200000003, 103.82298700000000, 0.104986018, 1.}}, {{71.817607699999996, 102.13470200000000, 41.411005299999999, 1.}, {71.817607699999996, 102.13470200000000, 0.104986018, 1.}}, {{70.605035400000006, 100.21911000000000, 41.411005299999999, 1.}, {70.605035400000006, 100.21911000000000, 0.104986018, 1.}}, {{69.750859800000001, 98.137878000000001, 41.411005299999999, 1.}, {69.750859800000001, 98.137878000000001, 0.104986018, 1.}}, {{69.275540699999993, 95.956791600000003, 41.411005299999999, 1.}, {69.275540699999993, 95.956791600000003, 0.104986018, 1.}}, {{69.187667399999995, 93.743676600000001, 41.411005299999999, 1.}, {69.187667399999995, 93.743676600000001, 0.104986018, 1.}}, {{69.483875999999995, 91.566292500000003, 41.411005299999999, 1.}, {69.483875999999995, 91.566292500000003, 0.104986018, 1.}}, {{70.149134599999996, 89.490257499999998, 41.411005299999999, 1.}, {70.149134599999996, 89.490257499999998, 0.104986018, 1.}}, {{71.157383400000001, 87.577071000000004, 41.411005299999999, 1.}, {71.157383400000001, 87.577071000000004, 0.104986018, 1.}}, {{72.472504099999995, 85.882293300000001, 41.411005299999999, 1.}, {72.472504099999995, 85.882293300000001, 0.104986018, 1.}}, {{74.049584199999998, 84.453935400000006, 41.411005299999999, 1.}, {74.049584199999998, 84.453935400000006, 0.104986018, 1.}}, {{75.836431700000006, 83.331106000000005, 41.411005299999999, 1.}, {75.836431700000006, 83.331106000000005, 0.104986018, 1.}}, {{77.775291100000004, 82.542953499999996, 41.411005299999999, 1.}, {77.775291100000004, 82.542953499999996, 0.104986018, 1.}}, {{79.804703500000002, 82.107931800000003, 41.411005299999999, 1.}, {79.804703500000002, 82.107931800000003, 0.104986018, 1.}}, {{81.861451099999996, 82.033405900000005, 41.411005299999999, 1.}, {81.861451099999996, 82.033405900000005, 0.104986018, 1.}}, {{83.882525599999994, 82.315606099999997, 41.411005299999999, 1.}, {83.882525599999994, 82.315606099999997, 0.104986018, 1.}}, {{85.807058299999994, 82.939926299999996, 41.411005299999999, 1.}, {85.807058299999994, 82.939926299999996, 0.104986018, 1.}}, {{87.578153000000000, 83.881550500000003, 41.411005299999999, 1.}, {87.578153000000000, 83.881550500000003, 0.104986018, 1.}}, {{89.144566900000001, 85.106384899999995, 41.411005299999999, 1.}, {89.144566900000001, 85.106384899999995, 0.104986018, 1.}}, {{90.462189100000003, 86.572260099999994, 41.411005299999999, 1.}, {90.462189100000003, 86.572260099999994, 0.104986018, 1.}}, {{91.495275699999993, 88.230363100000005, 41.411005299999999, 1.}, {91.495275699999993, 88.230363100000005, 0.104986018, 1.}}, {{92.217404999999999, 90.026850300000007, 41.411005299999999, 1.}, {92.217404999999999, 90.026850300000007, 0.104986018, 1.}}, {{92.612129199999998, 91.904588599999997, 41.411005299999999, 1.}, {92.612129199999998, 91.904588599999997, 0.104986018, 1.}}, {{92.673307899999998, 93.804968799999997, 41.411005299999999, 1.}, {92.673307899999998, 93.804968799999997, 0.104986018, 1.}}, {{92.405116000000007, 95.669733800000003, 41.411005299999999, 1.}, {92.405116000000007, 95.669733800000003, 0.104986018, 1.}}, {{91.821734300000003, 97.442764100000005, 41.411005299999999, 1.}, {91.821734300000003, 97.442764100000005, 0.104986018, 1.}}, {{90.946734599999999, 99.071767100000002, 41.411005299999999, 1.}, {90.946734599999999, 99.071767100000002, 0.104986018, 1.}}, {{89.812186600000004, 100.50981700000000, 41.411005299999999, 1.}, {89.812186600000004, 100.50981700000000, 0.104986018, 1.}}, {{88.457516299999995, 101.71670399999999, 41.411005299999999, 1.}, {88.457516299999995, 101.71670399999999, 0.104986018, 1.}}, {{86.928157700000000, 102.66004700000001, 41.411005299999999, 1.}, {86.928157700000000, 102.66004700000001, 0.104986018, 1.}}, {{85.274042800000004, 103.31615300000000, 41.411005299999999, 1.}, {85.274042800000004, 103.31615300000000, 0.104986018, 1.}}, {{83.547978599999993, 103.67058000000000, 41.411005299999999, 1.}, {83.547978599999993, 103.67058000000000, 0.104986018, 1.}}, {{81.803965800000000, 103.71841200000000, 41.411005299999999, 1.}, {81.803965800000000, 103.71841200000000, 0.104986018, 1.}}, {{80.095510399999995, 103.46422800000001, 41.411005299999999, 1.}, {80.095510399999995, 103.46422800000001, 0.104986018, 1.}}, {{78.473982300000003, 102.92178500000000, 41.411005299999999, 1.}, {78.473982300000003, 102.92178500000000, 0.104986018, 1.}}, {{76.987071200000003, 102.11341000000000, 41.411005299999999, 1.}, {76.987071200000003, 102.11341000000000, 0.104986018, 1.}}, {{75.677385099999995, 101.06914800000000, 41.411005299999999, 1.}, {75.677385099999995, 101.06914800000000, 0.104986018, 1.}}, {{74.581234100000003, 99.825682599999993, 41.411005299999999, 1.}, {74.581234100000003, 99.825682599999993, 0.104986018, 1.}}, {{73.727633100000006, 98.425068600000003, 41.411005299999999, 1.}, {73.727633100000006, 98.425068600000003, 0.104986018, 1.}}, {{73.137550200000007, 96.913325799999996, 41.411005299999999, 1.}, {73.137550200000007, 96.913325799999996, 0.104986018, 1.}}, {{72.823420900000002, 95.338935699999993, 41.411005299999999, 1.}, {72.823420900000002, 95.338935699999993, 0.104986018, 1.}}, {{72.788936899999996, 93.751290299999994, 41.411005299999999, 1.}, {72.788936899999996, 93.751290299999994, 0.104986018, 1.}}, {{73.029111999999998, 92.199144399999994, 41.411005299999999, 1.}, {73.029111999999998, 92.199144399999994, 0.104986018, 1.}}, {{73.530616899999998, 90.729118700000001, 41.411005299999999, 1.}, {73.530616899999998, 90.729118700000001, 0.104986018, 1.}}, {{74.272367399999993, 89.384299400000003, 41.411005299999999, 1.}, {74.272367399999993, 89.384299400000003, 0.104986018, 1.}}, {{75.226342700000004, 88.202977099999998, 41.411005299999999, 1.}, {75.226342700000004, 88.202977099999998, 0.104986018, 1.}}, {{76.358603200000005, 87.217561900000007, 41.411005299999999, 1.}, {76.358603200000005, 87.217561900000007, 0.104986018, 1.}}, {{77.630472800000007, 86.453703700000005, 41.411005299999999, 1.}, {77.630472800000007, 86.453703700000005, 0.104986018, 1.}}, {{78.999843299999995, 85.929643999999996, 41.411005299999999, 1.}, {78.999843299999995, 85.929643999999996, 0.104986018, 1.}}, {{80.422559399999997, 85.655812100000006, 41.411005299999999, 1.}, {80.422559399999997, 85.655812100000006, 0.104986018, 1.}}, {{81.853837400000003, 85.634675400000006, 41.411005299999999, 1.}, {81.853837400000003, 85.634675400000006, 0.104986018, 1.}}, {{83.249673700000002, 85.860842099999999, 41.411005299999999, 1.}, {83.249673700000002, 85.860842099999999, 0.104986018, 1.}}, {{84.568197100000006, 86.321408599999998, 41.411005299999999, 1.}, {84.568197100000006, 86.321408599999998, 0.104986018, 1.}}, {{85.770924600000001, 86.996534600000004, 41.411005299999999, 1.}, {85.770924600000001, 86.996534600000004, 0.104986018, 1.}}, {{86.823882999999995, 87.860223399999995, 41.411005299999999, 1.}, {86.823882999999995, 87.860223399999995, 0.104986018, 1.}}, {{87.698562600000002, 88.881279100000000, 41.411005299999999, 1.}, {87.698562600000002, 88.881279100000000, 0.104986018, 1.}}, {{88.372677999999993, 90.024404200000006, 41.411005299999999, 1.}, {88.372677999999993, 90.024404200000006, 0.104986018, 1.}}, {{88.830714599999993, 91.251402499999998, 41.411005299999999, 1.}, {88.830714599999993, 91.251402499999998, 0.104986018, 1.}}, {{89.064249000000004, 92.522444500000006, 41.411005299999999, 1.}, {89.064249000000004, 92.522444500000006, 0.104986018, 1.}}, {{89.072038399999997, 93.797355100000004, 41.411005299999999, 1.}, {89.072038399999997, 93.797355100000004, 0.104986018, 1.}}, {{88.859880000000004, 95.036881899999997, 41.411005299999999, 1.}, {88.859880000000004, 95.036881899999997, 0.104986018, 1.}}, {{88.440251900000007, 96.203902900000003, 41.411005299999999, 1.}, {88.440251900000007, 96.203902900000003, 0.104986018, 1.}}, {{87.831750600000007, 97.264538700000003, 41.411005299999999, 1.}, {87.831750600000007, 97.264538700000003, 0.104986018, 1.}}, {{87.058348100000003, 98.189133200000001, 41.411005299999999, 1.}, {87.058348100000003, 98.189133200000001, 0.104986018, 1.}}, {{86.148497300000002, 98.953077100000002, 41.411005299999999, 1.}, {86.148497300000002, 98.953077100000002, 0.104986018, 1.}}, {{85.134116599999999, 99.537449699999996, 41.411005299999999, 1.}, {85.134116599999999, 99.537449699999996, 0.104986018, 1.}}, {{84.049490599999999, 99.929463100000007, 41.411005299999999, 1.}, {84.049490599999999, 99.929463100000007, 0.104986018, 1.}}, {{82.930122699999998, 100.12269999999999, 41.411005299999999, 1.}, {82.930122699999998, 100.12269999999999, 0.104986018, 1.}}, {{81.811579499999993, 100.11714200000000, 41.411005299999999, 1.}, {81.811579499999993, 100.11714200000000, 0.104986018, 1.}}, {{80.728362200000007, 99.918992099999997, 41.411005299999999, 1.}, {80.728362200000007, 99.918992099999997, 0.104986018, 1.}}, {{79.712843500000005, 99.540302400000002, 41.411005299999999, 1.}, {79.712843500000005, 99.540302400000002, 0.104986018, 1.}}, {{78.794299600000002, 98.998425699999999, 41.411005299999999, 1.}, {78.794299600000002, 98.998425699999999, 0.104986018, 1.}}, {{77.998069000000001, 98.315309600000006, 41.411005299999999, 1.}, {77.998069000000001, 98.315309600000006, 0.104986018, 1.}}, {{77.344860400000002, 97.516663600000001, 41.411005299999999, 1.}, {77.344860400000002, 97.516663600000001, 0.104986018, 1.}}, {{76.850231600000001, 96.631027599999996, 41.411005299999999, 1.}, {76.850231600000001, 96.631027599999996, 0.104986018, 1.}}, {{76.524237999999997, 95.688772799999995, 41.411005299999999, 1.}, {76.524237999999997, 95.688772799999995, 0.104986018, 1.}}, {{76.371311300000002, 94.721082800000005, 41.411005299999999, 1.}, {76.371311300000002, 94.721082800000005, 0.104986018, 1.}}, {{76.383904400000006, 94.079625300000004, 41.411005299999999, 1.}, {76.383904400000006, 94.079625300000004, 0.104986018, 1.}}, {{76.417745800000006, 93.764781999999997, 41.411005299999999, 1.}, {76.417745800000006, 93.764781999999997, 0.104986018, 1.}}}, {3,1}};
  NURBSCurve curve={{{82.590441760000004, 93.433423149999996, 1.3664691899999999, 1.}, {74.593468410000000, 107.28458731000001, 11.677832530000000, 1.}, {67.794196490000004, 107.28458731000001, 11.677832530000000, 1.}, {66.055171930000000, 100.79445928000000, 18.428662989999999, 1.}, {79.915180860000007, 94.044880919999997, 8.4899551199999994, 1.}, {80.435717909999994, 90.849708669999998, 7.3044441400000002, 1.}, {77.964498780000000, 89.422949639999999, 8.9282437800000007, 1.}, {71.405593510000003, 93.209735370000004, 18.662592450000002, 1.}, {64.604393130000005, 97.136410229999996, 11.677832530000000, 1.}, {60.529016300000002, 90.077650500000004, 7.3565421100000004, 1.}, {61.852706509999997, 85.137571379999997, 11.677832530000000, 1.}, {65.517514250000005, 86.119553659999994, 11.677832530000000, 1.}, {81.279475120000001, 88.787741519999997, 16.404133649999999, 1.}, {82.966008479999999, 86.544302020000003, 11.677832530000000, 1.}, {74.432499269999994, 87.204450989999998, 11.677832530000000, 1.}, {72.507462320000002, 80.052285970000000, 11.677832530000000, 1.}, {71.159364179999997, 76.195238169999996, 8.4119728499999997, 1.}, {84.598869510000000, 74.761491860000007, 11.677832530000000, 1.}}, 3};
  NURBSCurveSurfaceIntersector intersector(curve, surface);

  auto res=intersector.intersect();
  for (auto& [name, pt, vec] : res) {
      std::cout  <<" "<< format_vec3(pt)<< std::endl;
  }
    std::cout << "----------------------------------------" << std::endl;
    std::vector<std::tuple<std::string, vec3, Vector<3>>> result2;
    csx(curve, surface,  result2,1e-3);
    for (auto& [name, pt, vec] : result2) {
        std::cout  <<" "<< format_vec3(pt)<< std::endl;
    }
    std::cout << "----------------------------------------" << std::endl;
}
